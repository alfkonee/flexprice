# Example: Minimal Operator Setup
# This configuration uses operators with minimal settings - single node instances
# without advanced features like backups, replication, or HA.
# 
# Good for: Development, testing, small deployments
# Not for: Production (use values-operators.yaml instead)

# FlexPrice application settings
flexprice:
  image:
    repository: ghcr.io/alfkonee/flexprice
    tag: "latest"
  
  deploymentMode: "production"
  
  api:
    replicas: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
  
  consumer:
    replicas: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
  
  worker:
    replicas: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
  
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: flexprice.local
        paths:
          - path: /
            pathType: Prefix

# PostgreSQL via Stackgres Operator - Minimal single node
postgres:
  external:
    enabled: false
  operator:
    # Install the Stackgres operator as a chart dependency
    install: true
    # Create the SGCluster CRD
    enabled: true
    name: "flexprice-postgres"
    version: "17"
    instances: 1  # Single node - no HA
    storage:
      size: "10Gi"
      storageClass: ""  # Use default storage class
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    connectionPooling:
      enabled: false  # Disabled for minimal setup
    backup:
      enabled: false  # No backups in minimal setup
    postgresConfig:
      max_connections: "100"
      shared_buffers: "256MB"
      work_mem: "16MB"
      maintenance_work_mem: "64MB"
      effective_cache_size: "512MB"
  user: "flexprice"
  password: ""  # Auto-generated
  database: "flexprice"
  maxOpenConns: 10
  maxIdleConns: 5

# ClickHouse via Altinity Operator - Minimal single node
clickhouse:
  external:
    enabled: false
  operator:
    # Install the Altinity ClickHouse operator as a chart dependency
    install: true
    # Create the ClickHouseInstallation CRD
    enabled: true
    name: "flexprice-clickhouse"
    version: "24.9"
    cluster:
      shardsCount: 1  # Single shard - no sharding
      replicasCount: 1  # Single replica - no HA
    storage:
      size: "10Gi"
      storageClass: ""  # Use default storage class
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "2000m"
    settings:
      max_memory_usage: "2000000000"
      max_concurrent_queries: "50"
    zookeeper:
      enabled: false  # Not needed for single replica
  user: "flexprice"
  password: ""  # Auto-generated
  database: "flexprice"

# Redpanda via Redpanda Operator - Minimal single node
kafka:
  external:
    enabled: false
  operator:
    # Install the Redpanda operator as a chart dependency
    install: true
    # Create the Redpanda cluster CRD
    enabled: true
    name: "flexprice-redpanda"
    version: "v24.2.7"
    replicas: 1  # Single node - no replication
    storage:
      size: "10Gi"
      storageClass: ""  # Use default storage class
    resources:
      cpu: "500m"
      memory: "1Gi"
    config:
      autoCreateTopicsEnabled: false
      groupInitialRebalanceDelayMs: 0
    schemaRegistry:
      enabled: false  # Disabled for minimal setup
    console:
      enabled: false  # Disabled for minimal setup
  consumerGroup: "flexprice-consumer"
  clientId: "flexprice-client"
  topics:
    - name: "events"
      partitions: 6
      replicationFactor: 1  # Single replica
    - name: "events_lazy"
      partitions: 3
      replicationFactor: 1
    - name: "events_post_processing"
      partitions: 3
      replicationFactor: 1
    - name: "system_events"
      partitions: 2
      replicationFactor: 1
    - name: "wallet_alert"
      partitions: 2
      replicationFactor: 1

# Temporal (deploy via chart) - Uses same PostgreSQL
temporal:
  external:
    enabled: false
  operator:
    # Install Temporal as a chart dependency
    install: true
    # Enable Temporal integration
    enabled: true
  namespace: "default"
  taskQueue: "billing-task-queue"
  # Temporal subchart configuration (when operator.install is true)
  server:
    config:
      persistence:
        default:
          driver: "sql"
          sql:
            driver: "postgres12"
            host: "flexprice-postgres"
            port: 5432
            database: "temporal"
            user: "flexprice"
            password: "change-me-in-production"
        visibility:
          driver: "sql"
          sql:
            driver: "postgres12"
            host: "flexprice-postgres"
            port: 5432
            database: "temporal_visibility"
            user: "flexprice"
            password: "change-me-in-production"

# Authentication
auth:
  provider: "flexprice"

# Observability
observability:
  sentry:
    enabled: false
  pyroscope:
    enabled: false
  logging:
    level: "info"

# Email (disabled)
email:
  enabled: false

# S3 (disabled)
s3:
  enabled: false

# Webhook
webhook:
  enabled: true
  pubsub: "kafka"

# Run migrations on install/upgrade
migrations:
  enabled: true
  runAsJob: true
  clickhouse:
    enabled: true
  postgres:
    enabled: true
  kafka:
    enabled: true
  temporal:
    enabled: true
